#!/usr/bin/env node

const cli = require('commander');
const glob = require('globby');

require('../lib/hooks');
const runner = require('../lib/runner');
const { description, version } = require('../package.json');


cli.version(version)
  .description(description)
  .usage('[path]')
  .parse(process.argv);

const pattern = cli.args[0] || 'bench/';

glob('**/setup.js', { realpath: true })
  .then((paths) => {
    if (paths[0]) {
      require(paths[0]); // eslint-disable-line global-require, import/no-dynamic-require
    }
  })
  .then(() => glob([pattern, '!**/setup.js'], { realpath: true }))
  // eslint-disable-next-line global-require, import/no-dynamic-require
  .then(paths => paths.map(file => require(file)))
  .then(() => runner.run());

